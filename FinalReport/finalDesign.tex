This chapter describes the evolution of frame format proposed in \ref{ch:proposal}. Also, it describes the reason for each change based on better understanding the needs of the other teams and the problems in the development. Figure \ref{Interface} is a diagram of our interaction with the other teams that make up this network. 
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.8\textwidth]{Interface_diagram.PNG}
    \caption{Diagram of how Module 6 interfaces with the rest of the network}
    \label{fig:Interface}
\end{figure}


\section{MAC Frame Construction}
%TODO Le
The proposed frame format in \ref{ch:proposal} had all the necessary fields and some removed to keep the model simple
The final frame format is  shown in \ref{tab:finalFrame}.
The figure \ref{fig:stateMachine} is the final state machine used to shows how the receiver will work

\begin{table}
\begin{tabular}{| c | c | c | c | c | c | c | }
  \hline                       
  Frame Type & Receiver UE & Sender UE & Data Size & Header CRC & Data & Data CRC\\
  \hline
	1 Byte & 1 Byte & 1 Byte & 1 Byte & 1 Byte & 1 to 234 Bytes & 1 Byte\\
  
  \hline  
\end{tabular}
 \caption{Final Frame Format}
	\label{tab:finalFrame}
\end{table}

\section{Transmission and reception process}
%Rebecca

Developing a frame format for transmission through the cellular network is only one part of the end-to-end requirements of data transmission. There must be a system put in place that transfers the data frame between devices and ensures that it gets to the proper receiver. Once at the receiver there should be a check to ensure that the data was received correctly. The reception of a correctly transmitted data frame should return a control frame, ACK, to the sender.  This allows the sending UE to be certain that the data was received correctly and allows it to resend the data frame if the ACK is not received. Just like the data frame, the ACK will have to be properly routed through the network. 

\subsection {Routing}

The network is initialized by Teams 4 and 5 who create a table of the BS to which each UE has connected. Each UE will always transmit to the same BS, so the data frame can be automatically be sent to the initial base station in the appropriate timeslot.  To determine the routing path at the base station we need to compare the receiver ID field with the IDs in the table and identify if the receiver is connected to the initial cell or if the data frame will need to be sent between cells. If it is sent to the second base station, the data frame will undergo the same routing check again before being sent to the device specified by the receiver. The response ACK will follow the reverse path with all of the same checks at the base station(s). The path through the base stations and UEs is depicted in Figure \ref{stateMachine}.

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.8\textwidth]{State_Machine_yellow.PNG}
    \caption{State Machine of the transmission of a package }
    \label{fig:stateMachine}
\end{figure}

\subsection {The ACK response }

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.8\textwidth]{ACK_timeout_short.PNG}
    \caption{Diagram of the shortest time between a UE transmitting a frame of data and receiving the corresponding ACK}
    \label{fig:ACKtimeshort}
\end{figure}

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.8\textwidth]{ACK_timeout_long.PNG}
    \caption{Diagram of the longest time between a UE transmitting a frame of data and receiving the corresponding ACK}
    \label{fig:ACKtimelong}
\end{figure}



% so I am going to be describing the state machine essentially....was going to do this but I might go and write the intro frist to have a beter idea of what is going on.




\section{Frame Types descriptions}
%Renato
We created two frame type baaed on the needs of make a end to end communication.

\begin{description}
  \item[Data Frame] \hfill \\
  It is used to transmit a string message with the limit of 234 bytes. The encode of those bytes is using a ASCII standard. All the bits are order to left most significant bit.
	It is important to guaranteed the decoding of this string in the receiver donâ€™t be machine depend. 
	
  \item[ACK Frame] \hfill \\
  It is the smallest package possible becuase it only have the header information because the data files is not transmitted. It make its transmission time smaller than any data frame. It is reused by Team 4 in their test. 
\end{description}

The frame object was used by other teams so three new types were defined and used by them.
\begin{description}
  \item[REQ Frame] \hfill \\
It is used by Team 4 to request a polling for all devices on the network. It was used by Team 4
	
  \item[Poll Frame] \hfill \\
 It is used by Team 4 to return the polling information of current device to requested polling. 
  \item[Table Frame] \hfill \\
 It is used by Team 5 to return the address table for all devices in the network.

\end{description} 

The frame type was a easy way to change the behavior of the receiving process based on the type.  
%RGB 253 254 202


